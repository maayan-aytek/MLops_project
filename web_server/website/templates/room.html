{% extends 'base.html' %} 
{% block content %}

<div class="question-box">
  <h2>Current Question</h2>
  <div id="current-question" class="question"></div>
</div>

<div class="participant-box">
  <h3>It's <span id="current-participant"></span>'s turn to answer.</h3>
</div>

<div class="answer-box">
  <textarea id="answer" rows="4" placeholder="Type your answer here..." disabled></textarea>
  <button id="submit-btn" onClick="sendAnswer()" disabled>Submit Answer</button>
</div>

<div id="message-box" style="color: red;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
        integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
        crossorigin="anonymous">
</script>
<script type="text/javascript">
  var socketio = io();

  const currentQuestion = document.getElementById("current-question");
  const currentParticipant = document.getElementById("current-participant");
  const answerInput = document.getElementById("answer");
  const submitButton = document.getElementById("submit-btn");
  const messageBox = document.getElementById("message-box");
  const debug = document.getElementById("debug");

  socketio.on("question", (data) => {
    currentQuestion.innerText = data.question;
    currentParticipant.innerText = data.is_participant_turn ? "your" : "another participant's";

    if (data.is_participant_turn) {
      answerInput.disabled = false;
      submitButton.disabled = false;
    } else {
      answerInput.disabled = true;
      submitButton.disabled = true;
    }
  });

  socketio.on("finish_turn", (data) => {
    socketio.emit("next_turn", {room_code: `${data.room_code}`});
});


  socketio.on("unauthorized", (data) => {
    messageBox.innerText = data.message;
  });

  const sendAnswer = () => {
    const answer = answerInput.value;
    const question = currentQuestion.innerText;
    if (answer === "" || question === "") return;
    socketio.emit("answer", { question: question, answer: answer });
    answerInput.value = "";
  };

  // Emit join event to receive the current question and participant
  socketio.emit("join", {});
</script>
{% endblock %}
