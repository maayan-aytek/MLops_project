{% extends "base.html" %}
{% block title %}Create Room{% endblock %}
{% block content %}
<h1>Create or Join a Chat Room</h1>
<br>
<label for="roomName">Room Name:</label>
<input type="text" id="roomName" placeholder="Enter room name">
<p></p>
<br>
<label for="username">Username:</label>
<input type="text" id="username" placeholder="Enter your username">
<p></p>
<br>
<button onclick="createRoom()">Create Room</button>
<button onclick="joinRoom()">Join Room</button>
<button onclick="leaveRoom()">Leave Room</button>
<br>
<div id="chat" style="margin-top: 20px; border: 1px solid #ccc; padding: 100px; max-height: 300px; overflow-y: scroll;"></div>
<br>
<input type="text" id="message" placeholder="Type a message..." style="width: 80%;">
<button onclick="sendMessage()">Send</button>

<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
<script type="text/javascript">
    var socket = io();

    // Event when connected to the server
    socket.on('connect', function() {
        console.log('Connected to server');
    });

    // Function to create a room
    function createRoom() {

        const room = document.getElementById('roomName').value;

        if (room === '') {
            alert('Please enter a room name.');
            return;
        }
        socket.emit('create_room', { room: room });
    }

    // Function to join a room
    function joinRoom() {
        const username = document.getElementById('username').value;
        const room = document.getElementById('roomName').value;
        if (username === '' || room === '') {
            alert('Please enter both username and room name.');
            return;
        }
        socket.emit('join', { username: username, room: room });
    }

    // Function to leave a room
    function leaveRoom() {
        const username = document.getElementById('username').value;
        const room = document.getElementById('roomName').value;
        if (username === '' || room === '') {
            alert('Please enter both username and room name.');
            return;
        }
        socket.emit('leave', { username: username, room: room });
    }

    // Function to send a message
    function sendMessage() {
        const message = document.getElementById('message').value;
        const room = document.getElementById('roomName').value;
        if (message === '' || room === '') {
            alert('Please enter a message and room name.');
            return;
        }
        socket.emit('message', { message: message, room: room });
        document.getElementById('message').value = '';
    }

    // Handle incoming messages
    socket.on('message', function(msg) {
        const chat = document.getElementById('chat');
        chat.innerHTML += '<p>' + msg + '</p>';
        chat.scrollTop = chat.scrollHeight; // Auto-scroll to the bottom
    });

    // Feedback for room creation, joining, and leaving
    socket.on('room_created', function(data) {
        alert('Room ' + data.room + ' created successfully.');
    });

    socket.on('joined_room', function(data) {
        alert(data.username + ' joined room ' + data.room);
    });

    socket.on('left_room', function(data) {
        alert(data.username + ' left room ' + data.room);
    });
</script>
{% endblock %}
