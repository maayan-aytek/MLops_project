{% extends 'base.html' %}
{% block content %}
<div class="lobby-container">
  <h2>Lobby</h2>
  <p>Waiting for participants to join...</p>
  <div id="participants-list">
    <!-- List of participants will be dynamically populated here -->
  </div>
</div>

<script src="https://cdn.socket.io/4.4.0/socket.io.min.js"></script>
<script>
  const socket = io();

  // Listen for updates on participants in the room
  socket.on('update_participants', function(data) {
    const participantsList = document.getElementById('participants-list');
    participantsList.innerHTML = '';  // Clear the current list
    data.participants.forEach(participant => {
      const div = document.createElement('div');
      div.textContent = participant;
      participantsList.appendChild(div);
    });
    
    // Redirect to the chat room if full
    if (data.is_full) {
      window.location.href = "{{ url_for('views.room') }}";
    }
  });

  // Notify server when user connects to the lobby
  socket.emit('connect_lobby');
</script>
{% endblock %}
